<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- <link rel="stylesheet" href="app.css"> -->
  <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous"> -->
  <link href="/assets/css/bootstrap.min.css" rel="stylesheet">
  <script src="/assets/js/bootstrap.min.js"></script>
  <link href="/assets/styles/all.css" rel="stylesheet">


  <title>teste</title>
</head>

<body class="bg-dark">
  <div class="container">
    <p>teste...</p>

    <div class="row">
      <div class="col-12">
        <img id="image" class="img-fluid w-25" src="/assets/images/cupom-fiscal-01.jpg">
      </div>
    </div>
    <div class="row">
      <div class="col-12 pt-1 pb-3 text-center">
        <div class="btn-group">
          <button type="button" class="btn btn-primary" title="Mover" onclick="dragModeImage(0)">
            <span class="docs-tooltip" title="">
              <span class="fas fa-arrows-alt"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Selecionar área de corte" onclick="dragModeImage(1)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-crop-alt"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" title="Ampliar imagem" onclick="zoomImage(0.1)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-search-plus"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Reduzir imagem" onclick="zoomImage(-0.1)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-search-minus"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" title="Mover à esquerda" onclick="moveImage(-10,0)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-arrow-left"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Mover à direita" onclick="moveImage(10,0)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-arrow-right"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Mover para cima" onclick="moveImage(0,-10)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-arrow-up"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Mover para baixo" onclick="moveImage(0,10)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-arrow-down"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" title="Girar sentido anti-horário" onclick="rotateImage(-1)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-undo-alt"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" title="Girar sentido anti-horário" onclick="rotateImage(1)">
            <span class="docs-tooltip" title="">
              <span class="fa fa-redo-alt"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" data-method="scaleX" data-option="-1" title="Flip Horizontal">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.scaleX(-1)">
              <span class="fa fa-arrows-alt-h"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" data-method="scaleY" data-option="-1" title="Flip Vertical">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.scaleY(-1)">
              <span class="fa fa-arrows-alt-v"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" data-method="crop" title="Crop">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.crop()">
              <span class="fa fa-check"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" data-method="clear" title="Clear">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.clear()">
              <span class="fa fa-times"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" data-method="disable" title="Disable">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.disable()">
              <span class="fa fa-lock"></span>
            </span>
          </button>
          <button type="button" class="btn btn-primary" data-method="enable" title="Enable">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.enable()">
              <span class="fa fa-unlock"></span>
            </span>
          </button>
        </div>

        <div class="btn-group">
          <button type="button" class="btn btn-primary" data-method="reset" title="Reset">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.reset()">
              <span class="fa fa-sync-alt"></span>
            </span>
          </button>
          <label class="btn btn-primary btn-upload" for="inputImage" title="Upload image file">
            <input type="file" class="sr-only" id="inputImage" name="file" accept="image/*">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="Import image with Blob URLs">
              <span class="fa fa-upload"></span>
            </span>
          </label>
          <button type="button" class="btn btn-primary" data-method="destroy" title="Destroy">
            <span class="docs-tooltip" data-toggle="tooltip" title="" data-original-title="cropper.destroy()">
              <span class="fa fa-power-off"></span>
            </span>
          </button>
        </div>
      </div>
    </div>


    <button class="btn btn-primary float-end" onclick="downloadImageCroped()">Cortar Imagem</button>
    <img src="" id="imagem-cortada" class="d-none">
  </div>


  <script src="/assets/js/jquery.js"></script><!-- jQuery is required -->
  <script src="/assets/js/cropper.js"></script><!-- Cropper.js is required -->
  <link href="/assets/css/cropper.css" rel="stylesheet">
  <script src="/assets/js/jquery-cropper.js"></script>
  <script>
    var $image = $('#image');

    $image.cropper({
      aspectRatio: null,
      initialAspectRatio: 16 / 9,
      crop: function (event) {
        // console.log(event.detail.x);
        // console.log(event.detail.y);
        // console.log(event.detail.width);
        // console.log(event.detail.height);
        // console.log(event.detail.rotate);
        // console.log(event.detail.scaleX);
        // console.log(event.detail.scaleY);
        console.log('cropado', cropper);
      },
    });



    // Get the Cropper.js instance after initialized
    var cropper = $image.data('cropper');

    const downloadImageCroped = () => {
      let canvas = cropper.getCroppedCanvas({
        width: 160,
        height: 90,
        minWidth: 256,
        minHeight: 256,
        maxWidth: 4096,
        maxHeight: 4096,
        fillColor: '#fff',
        imageSmoothingEnabled: false,
        imageSmoothingQuality: 'high',
      });
      $("#imagem-cortada").attr('src', canvas.toDataURL())
      $("#imagem-cortada").show('slow');
    }

    // Gira a imagem
    const rotateImage = (degree) => {
      cropper.rotate(degree);
    }

    const moveImage = (x, y) => {
      cropper.move(x, y);
    }

    const zoomImage = (zoom) => {
      cropper.zoom(zoom);
    }

    const dragModeImage = (mode) => {
      let setMode = "move";
      if (mode === 1)
        setMode = "crop";
      cropper.setDragMode(setMode);
    }



    // cropper.getCroppedCanvas();
    // cropper.getCroppedCanvas({
    //   width: 160,
    //   height: 90,
    //   minWidth: 256,
    //   minHeight: 256,
    //   maxWidth: 4096,
    //   maxHeight: 4096,
    //   fillColor: '#fff',
    //   imageSmoothingEnabled: false,
    //   imageSmoothingQuality: 'high',
    // });

    // // Upload cropped image to server if the browser supports `HTMLCanvasElement.toBlob`.
    // // The default value for the second parameter of `toBlob` is 'image/png', change it if necessary.
    // cropper.getCroppedCanvas().toBlob((blob) => {
    //   const formData = new FormData();

    //   // Pass the image file name as the third parameter if necessary.
    //   formData.append('croppedImage', blob/*, 'example.png' */);

    //   // Use `jQuery.ajax` method for example
    //   $.ajax('/path/to/upload', {
    //     method: 'POST',
    //     data: formData,
    //     processData: false,
    //     contentType: false,
    //     success() {
    //       console.log('Upload success');
    //     },
    //     error() {
    //       console.log('Upload error');
    //     },
    //   });
    // }/*, 'image/png' */);



  </script>
</body>

</html>